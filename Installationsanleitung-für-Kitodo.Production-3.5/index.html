
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Installationsanleitung für Kitodo.Production 3.5 - Kitodo Production Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ubersicht" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kitodo Production Documentation" class="md-header__button md-logo" aria-label="Kitodo Production Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kitodo Production Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Installationsanleitung für Kitodo.Production 3.5
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kitodo Production Documentation" class="md-nav__button md-logo" aria-label="Kitodo Production Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Kitodo Production Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ubersicht" class="md-nav__link">
    <span class="md-ellipsis">
      Übersicht
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-vorbereitende-schritte" class="md-nav__link">
    <span class="md-ellipsis">
      1. Vorbereitende Schritte
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Vorbereitende Schritte">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1a-host-konfiguration-uberprufen" class="md-nav__link">
    <span class="md-ellipsis">
      1a) Host-Konfiguration überprüfen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1b-datenpartition-bereitstellen" class="md-nav__link">
    <span class="md-ellipsis">
      1b) Datenpartition bereitstellen
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-softwarepakete-installieren" class="md-nav__link">
    <span class="md-ellipsis">
      2. Softwarepakete installieren
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-root-distinguished-name-ermitteln" class="md-nav__link">
    <span class="md-ellipsis">
      3. Root Distinguished Name ermitteln
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-name-service-switch-installieren" class="md-nav__link">
    <span class="md-ellipsis">
      4. Name Service Switch installieren
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-elasticsearch-installieren" class="md-nav__link">
    <span class="md-ellipsis">
      5. ElasticSearch installieren
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-datenbank-vorbereiten" class="md-nav__link">
    <span class="md-ellipsis">
      6. Datenbank vorbereiten
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-ldap-fur-samba-vorbereiten" class="md-nav__link">
    <span class="md-ellipsis">
      7. LDAP für Samba vorbereiten
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-samba-konfigurieren" class="md-nav__link">
    <span class="md-ellipsis">
      8. Samba konfigurieren
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-programmordner-und-dateien-erstellen" class="md-nav__link">
    <span class="md-ellipsis">
      9. Programmordner und -dateien erstellen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-skripte-konfigurieren" class="md-nav__link">
    <span class="md-ellipsis">
      10. Skripte konfigurieren
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-tomcat-konfigurieren" class="md-nav__link">
    <span class="md-ellipsis">
      11. Tomcat konfigurieren
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-logrotation-konfigurieren" class="md-nav__link">
    <span class="md-ellipsis">
      12. Logrotation konfigurieren
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-visuelle-konfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      13. Visuelle Konfiguration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. Visuelle Konfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#13a-indexaufbau" class="md-nav__link">
    <span class="md-ellipsis">
      13a) Indexaufbau
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13b-ldap-konfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      13b) LDAP-Konfiguration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Installationsanleitung für Kitodo.Production 3.5</h1>

<h2 id="ubersicht">Übersicht</h2>
<ol>
<li><a href="#1-vorbereitende-schritte">Vorbereitende Schritte</a>  </li>
<li><a href="#2-softwarepakete-installieren">Softwarepakete installieren</a>  </li>
<li><a href="#3-root-distinguished-name-ermitteln">Root Distinguished Name ermitteln</a>  </li>
<li><a href="#4-name-service-switch-installieren">Name Service Switch installieren</a>  </li>
<li><a href="#5-elasticsearch-installieren">ElasticSearch installieren</a>  </li>
<li><a href="#6-datenbank-vorbereiten">Datenbank vorbereiten</a>  </li>
<li><a href="#7-ldap-für-samba-vorbereiten">LDAP für Samba vorbereiten</a>  </li>
<li><a href="#8-samba-konfigurieren">Samba konfigurieren</a>  </li>
<li><a href="#9-programmordner-und--dateien-erstellen">Programmordner und -dateien erstellen</a>  </li>
<li><a href="#10-skripte-konfigurieren">Skripte konfigurieren</a>  </li>
<li><a href="#11-tomcat-konfigurieren">Tomcat konfigurieren</a>  </li>
<li><a href="#12-logrotation-konfigurieren">Logrotation konfigurieren</a>  </li>
<li><a href="#13-visuelle-konfiguration">Visuelle Konfiguration</a>  </li>
</ol>
<h2 id="1-vorbereitende-schritte">1. Vorbereitende Schritte</h2>
<h3 id="1a-host-konfiguration-uberprufen">1a) Host-Konfiguration überprüfen</h3>
<p>Prüfen Sie vor der Installation mit dem Kommando</p>
<pre><code>sudo hostname -f
</code></pre>
<p>ob der vollqualifizierte Domainname (FQDN) dem geplanten Servernamen entspricht. Dieser wird während der LDAP-Installation für die Bildung des Root Distinguished Name (RDN) und die Basiskonfiguration des LDAP genutzt, was sich später nur umständlich korrigieren lässt. Hier sollte der FQDN, z.B. <code>rechnername.rz.example.de</code>, angezeigt werden, nicht bloß <code>rechnername</code>. Wenn nicht, konfigurieren Sie zuerst <code>/etc/hosts</code> richtig.</p>
<h3 id="1b-datenpartition-bereitstellen">1b) Datenpartition bereitstellen</h3>
<p>Die Digitalisierung erzeugt viele Daten. In der Regel werden diese Daten auf einer eigenen Partition gespeichert, bei der es sich wahrscheinlich um ein Netzwerkgerät (auch bekannt als NAS) handelt. Mit dem folgenden Befehl erstellen wir einen Einhängepunkt für die Datenpartition als <code>/mnt/data</code>:</p>
<pre><code>sudo mkdir /mnt/data
</code></pre>
<p>Wie der Datenspeicher bereitgestellt wird, hängt stark von der verwendeten Hardware und den verwendeten Netzwerken ab. Wenn Sie eine Datenpartition verwenden möchten, stellen Sie sicher, dass die Datenpartition am angegebenen Bereitstellungspunkt bereitgestellt ist. Jetzt ist es ein guter Moment, um zu überlegen, ob Sie LVM einrichten möchten.</p>
<h2 id="2-softwarepakete-installieren">2. Softwarepakete installieren</h2>
<p>Installieren Sie mit der Paketverwaltung Tomcat 9, MariaDB, ImageMagick, LDAP incl. Utils, Samba, den Apache Webserver und den Jakarta Connector. Für die Installation benötigen wir außerdem HTTPS-Unterstützung für Apt, Unzip und das Tool dos2unix. Während der Installation werden Sie nach dem Passwort für den LDAP-Server gefragt. Das Passwort wird von Production unverschlüsselt in der Datenbank gespeichert. Wählen Sie kein wertvolles Passwort.</p>
<pre><code class="language-sh">sudo apt-get update
sudo apt-get install tomcat9 mariadb-server imagemagick slapd ldap-utils samba apt-transport-https unzip dos2unix
</code></pre>
<h2 id="3-root-distinguished-name-ermitteln">3. Root Distinguished Name ermitteln</h2>
<p>Mit dem Kommando</p>
<pre><code>sudo slapcat
</code></pre>
<p>können wir den Inhalt des LDAP-Servers anzeigen. Die Einträge sind durch Leerzeilen getrennt. Hier finden wir den erzeugten Root Distinguished Name (RDN) im Eintrag mit der Eigenschaft <code>objectClass:top</code> unter dem Schlüssel <code>dn</code>.</p>
<p>Wenn Sie ein Testsystem einrichten, das keinen DNS-Namen erhalten soll, wird als RDN <code>dc=nodomain</code> verwendet. Der LDAP-Admin-Benutzer hat den Common Name (CN) <code>cn=admin,dc=nodomain</code>. Diese Angaben werden auch in dieser Installationsanleitung verwendet. Wenn Sie den Rechner in Ihrem Netzwerk installieren, wird hier etwas wie <code>dc=rz,dc=example,dc=de</code> stehen. Benutzen Sie dann diese Zeichenkette anstelle von <code>dc=nodomain</code> im weiteren Verlauf der Installationsanleitung.</p>
<h2 id="4-name-service-switch-installieren">4. Name Service Switch installieren</h2>
<p>Nun installieren wir noch die Name-Service-Switch-LDAP-Bibliothek:</p>
<pre><code>sudo apt-get install libnss-ldap
</code></pre>
<p>Während der Installation werden Sie nach einigen Einstellungen gefragt:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LDAP server Uniform Resource Identifier:</strong></td>
<td>ldapi:///</td>
</tr>
<tr>
<td><strong>LDAP search base:</strong></td>
<td>ou=users,dc=nodomain</td>
</tr>
<tr>
<td><strong>LDAP version:</strong></td>
<td>3</td>
</tr>
<tr>
<td><strong>Make local root database admin:</strong></td>
<td>No</td>
</tr>
<tr>
<td><strong>Does the LDAP server require login?</strong></td>
<td>No</td>
</tr>
</tbody>
</table>
<p>Falls Sie diesen Schritt wiederholen wollen oder müssen, geben Sie dazu nacheinander die beiden folgenden Kommandos ein:</p>
<pre><code>sudo apt-get purge libnss-ldap
sudo apt-get install libnss-ldap
</code></pre>
<h2 id="5-elasticsearch-installieren">5. ElasticSearch installieren</h2>
<p>Beachten Sie, dass Sie ElasticSearch Version 7 installieren müssen. </p>
<pre><code class="language-sh">export JAVA_HOME=/usr/lib/jvm/default-java
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
sudo add-apt-repository &quot;deb https://artifacts.elastic.co/packages/7.x/apt stable main&quot;
sudo apt-get update
sudo apt-get install elasticsearch
sudo systemctl enable elasticsearch
sudo systemctl start elasticsearch
</code></pre>
<h2 id="6-datenbank-vorbereiten">6. Datenbank vorbereiten</h2>
<p>Während die Digitalisierungsdaten in Dateien auf dem Datenbereitstellungspunkt gespeichert werden, werden die Prozessdaten (Projekte, Mitarbeiter, Fortschritt von Objekten im Workflow usw.) in einer Datenbank gespeichert. Sie müssen eine Datenbank auf dem MariaDB-Server erstellen und den Zugriff für Production konfigurieren.</p>
<pre><code class="language-sql">sudo mariadb
create database kitodo;
create user 'kitodo'@'localhost' identified by 'kitodo';
grant all on kitodo.* to 'kitodo'@'localhost';
exit;
</code></pre>
<p>Anschließend laden Sie die Datenbankinhaltsvorlage herunter und laden sie in die Datenbank:</p>
<pre><code class="language-sh">wget https://github.com/kitodo/kitodo-production/releases/download/kitodo-production-3.5.0/kitodo_3-5-0.sql
mariadb -u kitodo -pkitodo -D kitodo &lt; kitodo_3-5-0.sql
</code></pre>
<h2 id="7-ldap-fur-samba-vorbereiten">7. LDAP für Samba vorbereiten</h2>
<p>Laden Sie das Samba-Schema in LDAP:</p>
<pre><code>wget https://raw.githubusercontent.com/zentyal/samba/master/examples/LDAP/samba.ldif
cat samba.ldif | sudo ldapadd -Q -Y EXTERNAL -H  ldapi:///
</code></pre>
<p>Erstellen Sie im LDAP einen Eintrag für die Gruppe der Production-Benutzenden. Erstellen Sie dazu eine Datei <code>users.ldif</code> mit folgendem Inhalt:</p>
<pre><code class="language-ldif">dn: ou=users,dc=nodomain
objectClass: organizationalUnit
ou: users
</code></pre>
<p>Die Datei laden Sie in LDAP mit:</p>
<pre><code>ldapadd -x -D cn=admin,dc=nodomain -w 'LDAP-Admin-Passwort' &lt; users.ldif
</code></pre>
<p>Ermitteln Sie die Gruppennummer für alle Benutzenden:</p>
<pre><code>grep users /etc/group
</code></pre>
<p>Es handelt sich um die Zahl zwischen dem zweiten und dritten Doppelpunkt. (Meistens ist das die 100.)</p>
<p>Ermitteln Sie die höchste vergebene Benutzendennummer. Betrachten Sie dazu die Datei <code>/etc/passwd</code>.</p>
<pre><code>less /etc/passwd
</code></pre>
<p>Jede Zeile entspricht einem Benutzendenkonto. Die Benutzendennummer steht zwischen dem zweiten und dritten Doppelpunkt (die erste der beiden Zahlen). Alle Benutzenden, die keine Systemkonten sind, haben eine Benutzendennummer ab 1000 aufsteigend. Suchen Sie die erste Zahl größer als 1000, die <em>nicht mehr</em> vorkommt. Dies ist die nächste <em>freie</em> Benutzendennummer. Die Anzeige beenden Sie mit einem Druck auf die Taste <kbd>Q</kbd>.</p>
<p>Erstellen Sie eine Datei <code>nextfreeunixid.ldif</code> mit folgendem Inhalt. Setzen Sie dabei die ermittelten Angaben ein:</p>
<pre><code class="language-ldif">dn: cn=NextFreeUnixId,dc=nodomain
objectClass: inetOrgPerson
sn: NextFreeUnixId
objectClass: posixAccount
cn: NextFreeUnixId
uid: nextfreeunixid
uidNumber: #die nächste freie Benutzendennummer#
gidNumber: #die ermittelte Gruppennummer#
homeDirectory: /dev/null
</code></pre>
<p>Die Datei laden Sie in LDAP mit:</p>
<pre><code>ldapadd -x -D cn=admin,dc=nodomain -w 'LDAP-Admin-Passwort' &lt; nextfreeunixid.ldif
</code></pre>
<h2 id="8-samba-konfigurieren">8. Samba konfigurieren</h2>
<p>Bearbeiten Sie die Datei <code>/etc/samba/smb.conf</code>, sodass sie folgendes enthält:</p>
<pre><code class="language-smb.conf">[global]
workgroup = KITODO
unix extensions = no
wide links = yes
load printers = no
security = user
invalid users = root
encrypt passwords = yes

ntlm auth = yes
lanman auth = no
client ntlmv2 auth = yes

passdb backend = ldapsam:ldap://127.0.0.1
ldap suffix = dc=nodomain
ldap user suffix = ou=users
ldap group suffix = ou=groups
ldap admin dn = cn=admin,dc=nodomain
ldap ssl = no
ldap passwd sync = yes
ldap delete dn = no

[homes]
comment = Home Directories
path = /usr/local/kitodo/users/%U
read only = no
browseable = no
valid users = %S
guest ok = no
inherit permissions = yes
</code></pre>
<p>Passen Sie die Konfiguration des Name Service Switch, <code>/etc/nsswitch.conf</code> an:
Ergänzen Sie die Zeile <code>passwd:</code> um das Argument <code>ldap</code>:</p>
<pre><code>passwd:         compat systemd ldap
</code></pre>
<p>Setzen Sie in Samba das LDAP-Passwort:</p>
<pre><code>sudo smbpasswd -w 'LDAP-Admin-Passwort'
</code></pre>
<p>Starten Sie die Samba-Dienste neu:</p>
<pre><code>sudo systemctl restart smbd nmbd
</code></pre>
<h2 id="9-programmordner-und-dateien-erstellen">9. Programmordner und -dateien erstellen</h2>
<p>Laden Sie die Software, die Module und die Konfigurationsdateien herunter, erstellen Sie einen Programmordner, entpacken Sie die Module und Konfigurationsdateien. Den metadata-Ordner legen Sie auf die Datenpartition. Vergeben Sie die notwendigen Berechtigungen:</p>
<pre><code class="language-sh">wget https://github.com/kitodo/kitodo-production/releases/download/kitodo-production-3.5.0/kitodo-3.5.0.war
wget https://github.com/kitodo/kitodo-production/releases/download/kitodo-production-3.5.0/kitodo_3-5-0_config_modules.zip

sudo mkdir /usr/local/kitodo
sudo unzip kitodo_3-5-0_config_modules.zip -x scripts/*.bat -d /usr/local/kitodo
</code></pre>
<p>Wenn Sie die Übersetzungstexte der grafischen Oberfläche lokal verändern wollen, führen Sie die beiden folgenden Kommandos aus. Dies hat den Nachteil, dass bei künftigen Updates neu hinzugekommene Beschriftungen nicht automatisch zur Verfügung stehen. Daher ist dieser Schritt optional. (Wichtig: Wenn Sie die Übersetzungstexte nicht anpassen wollen, darf auch der Ordner <code>/usr/local/kitodo/messages</code> nicht erstellt werden.)</p>
<pre><code class="language-sh">sudo mkdir /usr/local/kitodo/messages
sudo unzip -j kitodo-3.5.0.war 'WEB-INF/classes/messages/*' -d /usr/local/kitodo/messages
</code></pre>
<p>Anschließend geht es in jedem Fall so weiter:</p>
<pre><code class="language-sh">cd /usr/local/kitodo
sudo mv metadata /mnt/data
sudo ln -s /mnt/data/metadata
sudo mkdir logs temp
# sudo chown -R ‹Admin-Benutzer›:users config messages rulesets xslt #optional
sudo chown -R tomcat:tomcat diagrams logs metadata temp users 
</code></pre>
<h2 id="10-skripte-konfigurieren">10. Skripte konfigurieren</h2>
<pre><code>sudo dos2unix scripts/*.sh
sudo chown tomcat scripts/*.sh
sudo chmod 544 scripts/*.sh
cd
</code></pre>
<p>Ändern Sie die Datei <code>/usr/local/kitodo/scripts/script_createDirUserHome.sh</code> wie folgt:</p>
<pre><code class="language-sh">#!/bin/sh
User=&quot;$1&quot;
Home=&quot;$2&quot;

/bin/mkdir &quot;$Home&quot;
/bin/chmod g+w &quot;$Home&quot;
sudo /bin/chown $User &quot;$Home&quot;
sudo /bin/chgrp tomcat &quot;$Home&quot;
</code></pre>
<p>Ändern Sie die Datei <code>/usr/local/kitodo/scripts/script_createSymLink.sh</code> wie folgt:</p>
<pre><code class="language-sh">#!/bin/sh
Source=&quot;$1&quot;
Target=&quot;$2&quot;
User=&quot;$3&quot;

/bin/ln -s &quot;$Source&quot; &quot;$Target&quot;
sudo /bin/chown -R $User &quot;$Source&quot;
</code></pre>
<p>Erstellen Sie mit dem Kommando <code>sudo visudo -f /etc/sudoers.d/kitodo</code> eine Datei mit folgendem Inhalt:</p>
<pre><code class="language-sudoers">User_Alias TOMCAT_USER = tomcat

Cmnd_Alias CHOWN_METADATA = /bin/chown -R * /usr/local/kitodo/metadata/*
Cmnd_Alias CHOWN_USERS = /bin/chown * /usr/local/kitodo/users/*
Cmnd_Alias CHGRP_USERS = /bin/chgrp tomcat9 /usr/local/kitodo/users/*

TOMCAT_USER ALL=NOPASSWD: CHOWN_METADATA, CHOWN_USERS, CHGRP_USERS
</code></pre>
<h2 id="11-tomcat-konfigurieren">11. Tomcat konfigurieren</h2>
<p>Passen Sie die Default-Einstellungen des Tomcat, <code>/etc/default/tomcat9</code> an:
Ergänzen Sie die Zeile <code>JAVA_OPTS</code>, um dem Tomcat mehr Arbeitsspeicher (4G, davon 256m für den Programmcode) zu geben:</p>
<pre><code>JAVA_OPTS="-Djava.awt.headless=true -XX:+UseConcMarkSweepGC -Xmx4G -XX:MaxPermSize=256m"
</code></pre>
<p>Bearbeiten Sie die Datei <code>/lib/systemd/system/tomcat9.service</code>: Fügen Sie im Abschnitt <code>[Service]</code> die Zeile <code>ReadWritePaths=/usr/local/kitodo/</code> hinzu. (Die Zeile <code>ReadWritePaths=</code> darf wiederholt werden.) Ändern Sie den Wert von <code>NoNewPrivileges</code> auf <code>false</code>.</p>
<p>Starten Sie danach den Tomcat neu:</p>
<pre><code>sudo systemctl daemon-reload
sudo service tomcat9 restart
</code></pre>
<p>Installieren Sie die Webanwendung:</p>
<pre><code>sudo cp kitodo-3.5.0.war /var/lib/tomcat9/webapps/kitodo##3.5.0.war
</code></pre>
<h2 id="12-logrotation-konfigurieren">12. Logrotation konfigurieren</h2>
<p>Erstellen Sie die Datei <code>/etc/logrotate.d/kitodo</code> z.B. mit folgendem Inhalt:</p>
<pre><code class="language-logrotate">/usr/local/kitodo/logs/kitodo.log {
    copytruncate
    daily
    rotate 7
    ifempty
    compress
    compresscmd /usr/bin/gzip
    uncompresscmd /usr/bin/gunzip
    missingok
    nomail
 }
</code></pre>
<h2 id="13-visuelle-konfiguration">13. Visuelle Konfiguration</h2>
<p>Sie erreichen die Webanwendung im WWW-Browser unter der Adresse: <code>http://</code><em>host</em><code>:8080/kitodo</code>. Melden Sie sich mit dem Benutzernamen <code>testadmin</code> und dem Passwort <code>test</code> an.</p>
<h3 id="13a-indexaufbau">13a) Indexaufbau</h3>
<p>Es öffnet sich die Seite System – Indexierung. Erzeugen Sie das ElasticSearch-Mapping und indexieren Sie den gesamten Index komplett.</p>
<h3 id="13b-ldap-konfiguration">13b) LDAP-Konfiguration</h3>
<p>Wechseln Sie dann über das Hauptmenü, den “Zauberwürfel” rechts oben, zu <em>Benutzer</em>. Erstellen Sie mit dem “Neu”-Button einen neuen LDAP-Server mit folgenden Einstellungen:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Manager login</td>
<td><code>cn=admin,dc=nodomain</code></td>
</tr>
<tr>
<td>nextFreeUnixIdPattern</td>
<td><code>cn=NextFreeUnixId,dc=nodomain</code></td>
</tr>
<tr>
<td>URL</td>
<td><code>ldap://localhost:389/</code></td>
</tr>
<tr>
<td>Manager password</td>
<td><em>LDAP-Admin-Passwort</em></td>
</tr>
</tbody>
</table>
<p>Wechseln Sie zum Tab “LDAP-Gruppen”. Ermitteln Sie den Secure Identifier (SID) mit dem Kommando:</p>
<pre><code>sudo net getlocalsid
</code></pre>
<p>Passen Sie die Einstellungen der LDAP-Gruppe wie folgt an:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th>Beispiel</th>
</tr>
</thead>
<tbody>
<tr>
<td>User DN</td>
<td><code>cn={login},ou=users,dc=nodomain</code></td>
<td><code>cn={login},ou=users,dc=nodomain</code></td>
</tr>
<tr>
<td>gidNumber</td>
<td><em>Gruppennummer</em></td>
<td><code>100</code></td>
</tr>
<tr>
<td>sambaSID</td>
<td><em>SID</em><code>-{uidnumber*2+1001}</code></td>
<td><code>S-1-5-21-123456789-1234567890-1234567890-{uidnumber*2+1001}</code></td>
</tr>
<tr>
<td>LDAP-Server</td>
<td><em>den soeben erstellten Server auswählen</em></td>
<td>Lokaler LDAP-Server</td>
</tr>
<tr>
<td>loginShell</td>
<td><code>/bin/false</code></td>
<td><code>/bin/false</code></td>
</tr>
<tr>
<td>sambaPrimaryGruopSID</td>
<td><em>SID</em><code>-1000</code></td>
<td><code>S-1-5-21-123456789-1234567890-1234567890-1000</code></td>
</tr>
<tr>
<td>sambaLogonHours</td>
<td><code>FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</code></td>
<td><code>FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</code></td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>